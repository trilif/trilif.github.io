<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->

<!DOCTYPE html>
 
<html> 
   
<head>
 

<!-- Office JavaScript API -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
	
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>

<style>
html, body {
width:100%;
height: 100%;
margin: 0;
}
.leaflet-container {
max-width: 100%;
max-height: 100%;
}
</style>
	
</head>
 
 

<body>
<button onclick="getSel()">Kijelölés begyűjtése</button><br><br>
 <p id="koordz">koordz</p>
	 <p id="selectedt">selec</p><br><br>
  <div id="map" style="width: 100%; height: 400px;"></div>
</body>

 

<script>

const map = L.map('map').setView([47.5, 19], 13);

const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
maxZoom: 19,
attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

function addCoords(lat,lng){
L.marker([lat, lng]).addTo(map);
map.flyTo([lat, lng]);
}	
	
	
	
	// Get selected data.


function getSel(){	
	
	Office.context.mailbox.item.getSelectedDataAsync(Office.CoercionType.Text, function(asyncResult) {
  if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
    const text = asyncResult.value.data;
    const prop = asyncResult.value.sourceProperty;
    console.log("Selected text in " + prop + ": " + text);
	  $("#selectedt").html(text);
	  var text2= text.replace(" ", "");
	const selArray = text2.split("+");
	getRes(selArray[0],selArray[1]);
	  
  } else {
    console.error(asyncResult.error);
  }
});
	
	
	
/*	
	
	Office.initialize = function () {
    Office.context.mailbox.item.getSelectedDataAsync(Office.CoercionType.Text, {}, getCallback);
};
	
function getCallback(asyncResult) {
    const text = asyncResult.value.data;
    const prop = asyncResult.value.sourceProperty;

    console.log("Selected text in " + prop + ": " + text);
	$("#selectedt").html(text); 
	
}
*/
}
  function getRes(kmko,dm){
	  
	 
	  
  	$.ajax({
  type: "GET",
  url: "https://varosmajorifalevelek.hu/mkif/index3.php?dm="+dm+"&kmko="+kmko+"&ap=M7&pkod=2",
  datatype: "html",
  success: function(response) {
 
		$("#koordz").html(response); 
		var koordArr=response.split(";"); 
		
		addCoords(koordArr[1],koordArr[0]);
}
});
  
  }
//getRes();
	

	
</script>
 
 

</html>
